from dataclasses import dataclass

from stw_py_api_runtime.gen_classes.gen_device import GenTm
from stw_py_api_runtime.sdk.brokers.broker_api import BrokerAPI, TmCatcherAPI
from stw_py_api_runtime.sdk.brokers.message import DeviceAddress
from stw_py_api_runtime.gen_classes.telemetry.parse import Message as _Message
from stw_gen_sample3_api.basic_types import *


@dataclass
class StatusTm(_Message):
    """Статус загрузки прошивки."""

    # Идентификатор активной области приёма ПО
    bank: uint8_t
    # Размер загруженной части прошивки
    uploadedSize: uint32_t
    # Ожидаемый размер прошивки
    expectedSize: uint32_t


@dataclass
class InfoTm(_Message):
    """Информация о модуле перепрошивки."""

    # Количество областей приёма ПО
    bankCount: uint8_t
    # Максимальный размер прошивки
    maxSize: uint32_t
    # Этап загрузки прошивки
    from stw_gen_sample3_api.types.core.frm.stage_type import Stage
    stage: Stage


@dataclass
class BurnStatusTm(_Message):
    """Статус прожига прошивки."""

    # None
    from stw_gen_sample3_api.types.core.frm.burn_events__opt__type import BurnEvents_Opt_
    value: BurnEvents_Opt_


class Tm(GenTm):
    def __init__(self, device_address: DeviceAddress, broker: BrokerAPI, pygen_device):
        """Конструктор модуля телеметрии."""

        self.status = broker.tm_catcher_class[StatusTm](
            device_address=device_address, broker=broker, pygen_device=pygen_device,msg_type=StatusTm, name='core.frm.status',
            msg_id=4234726868, req_id=540676386, rep_id=1463624116,
        )
        self.info = broker.tm_catcher_class[InfoTm](
            device_address=device_address, broker=broker, pygen_device=pygen_device,msg_type=InfoTm, name='core.frm.info',
            msg_id=1880978888, req_id=1207833621, rep_id=821634179,
        )
        self.burnStatus = broker.tm_catcher_class[BurnStatusTm](
            device_address=device_address, broker=broker, pygen_device=pygen_device,msg_type=BurnStatusTm, name='core.frm.burnStatus',
            msg_id=3461637984, req_id=3722524710, rep_id=2867202224,
        )
