"""Конфигурация для работы."""

from configparser import ConfigParser, SectionProxy
from pathlib import Path

from stw_pro_test.config.ini_config.structures import DeviceConfig, PowerSupplyConfig
from stw_pro_test.config.ini_config.utils import prepare_config, prepare_defaults

general_config: ConfigParser
defaults: SectionProxy
device_config: DeviceConfig
psu_config: PowerSupplyConfig


def prepare_configs(
    path_to_config: Path | str | None = None,
    params_to_override: dict[str, str] | None = None,
) -> None:
    """
    Prepare all configurations.

    Just one function to call to change global variables
    """
    global general_config, defaults, device_config, psu_config  # noqa: WPS420

    params_to_override = params_to_override or {}

    general_config = prepare_config(path_to_config)
    defaults = prepare_defaults(general_config, params_to_override)
    device_config = DeviceConfig(**defaults)
    psu_config = PowerSupplyConfig(defaults)
