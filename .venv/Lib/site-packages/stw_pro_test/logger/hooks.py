"""Hooks and pytest setup for logger."""

import pytest
from loguru import logger

from .install import install_log


def pytest_addoption(parser):
    """Add custom cli arguments."""
    options_group: pytest.OptionGroup = parser.getgroup('stw-pro-test.logger options')
    options_group.addoption(
        '--logs_dir',
        action='store',
        default=None,
        help='Directory to save .log files',
    )


def pytest_configure(config):
    """
    Allow plugins and conftest files to perform initial configuration.

    This hook is called for every plugin and initial conftest file after command line options have been parsed.
    After that, the hook is called for other conftest files as they are imported.
    """
    logs_dir = config.option.logs_dir
    log_path = install_log(outer_logger=logger, log_dir_path=logs_dir)
    logger.debug(f'Логгер инициализирован. Файл сохранится в {log_path.absolute()}')
