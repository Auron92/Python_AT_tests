"""Файл с родительским классом для pygen xxxDevice'ов."""
from loguru import logger
from stw_py_api_runtime.gen_classes.cmd_helpers import sync_reboot, verify_module
from stw_py_api_runtime.sdk.brokers.broker_api import BrokerAPI
from stw_py_api_runtime.sdk.brokers.message import DeviceAddress


class PyGenDevice(object):  # noqa: WPS230
    """Родительский класс для pygen xxxDevice'ов."""

    def __init__(
        self,
        broker: BrokerAPI,
        device_id: int | None = None,
        ip_address: str | None = None,
    ):  # noqa: F405
        self.broker = broker
        self._device_address = DeviceAddress(node_id=device_id, endpoint=ip_address)

        self.cmds = None
        self.tms = None
        self.events = None

    @property
    def device_id(self):
        """Id устройства на шине Can."""
        return self._device_address.node_id

    @device_id.setter
    def device_id(self, value):
        self._device_address.node_id = value
        logger.warning(f'Device id changed from {self._device_address.node_id} to {value}')  # noqa: WPS237

    @property
    def ip_address(self):
        """Ip адрес устройства."""
        return self._device_address.endpoint

    @ip_address.setter
    def ip_address(self, value):
        self._device_address.endpoint = value
        logger.warning(f'Device ip address changed from {self._device_address.endpoint} to {value}')  # noqa: WPS237

    def reboot(self, timeout):
        """Синхронная перезагрузка."""
        sync_reboot(self, timeout)

    def verify_module(self):
        """Синхронная верификация CAN модуля."""
        verify_module(self)
