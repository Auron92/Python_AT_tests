Metadata-Version: 2.1
Name: graveyard-upload
Version: 0.2.3
Summary: Package to upload file to our graveyard service
Author: Kirill Revnivtsev
Author-email: k.revnivtsev@1440.space
Requires-Python: >=3.10,<3.11
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.10
Requires-Dist: argparse (>=1.4.0,<2.0.0)
Requires-Dist: requests (>=2.28.2,<3.0.0)
Description-Content-Type: text/markdown

# Graveyard upload

Скрипт, который позволит вам загрузить .bin/.zpaq файлы в graveyard.

<table border="0">
<tr>
<td><b style="font-size:25px"></b></td>
<td><b style="font-size:25px">Poetry</b></td>
<td><b style="font-size:25px">Pip</b></td>
</tr>
<tr>
<td><b style="font-size:16px">Installation</b></td>
<td>
poetry install
</td>
<td>
pip install -i https://pypi.1440.space/repository/pypi_all/simple graveyard-upload
</td>
</tr>
<tr>
<td><b style="font-size:16px">Usage</b></td>
<td>
poetry run python graveyard_upload --help
</td>
<td>
graveyard_upload {linux,firmware} --help
</td>
</tr>
</table>


## Example send firmware

```bash
graveyard_upload firmware -token $TOKEN -firmwareFile stw-cpsu.v0-mf.r2-0.7.1.113.bin -zpaqFile stw-cpsu.v0-mf.r2-0.7.1.113.zpaq -branch MR-16 -commitHash 0bf90a7 -graveyard-url https://graveyard.1440.space
```

## Example send linux 

Принимает `{0..N}` zpaq файлов. Использовать аргумент `-zpaqFile`

```bash
graveyard_upload linux -token $TOKEN -firmwareFile stw-dsua.v1-os-0.8.0.736.tar.gz -branch develop -commitHash 123123 -graveyard-url https://graveyard.1440.space
```

```bash
graveyard_upload linux -token $TOKEN -firmwareFile stw-dsp_als.v0-os.r3-0.2.0.289.tar.gz -branch develop -commitHash 123123 -graveyard-url https://graveyard.1440.space -zpaqFile Device.Tmtckar2.zpaq -zpaqFile download/stw-astra.v1-main.r2.r3-0.11.0.1578.zpaq
```

## Example download firmware from graveyard.1440.space

Скачать прошивку из graveyard.1440.space. Нужно указать `firmwareId`, `version`.
Скачивает все файлы и записывает метаинформацию в файл `graveyard.json`

```bash
graveyard_upload download -token $TOKEN -firmwareId dsp_krl-main.1440 -version r2_release_2_13.1465
```

## Token

Чтобы получить токен, необходимо получить соотвествующие права в Keycloak (sw-auth.1440.space).
Для этого необходимо связаться с Павел Пакхмутовов, Леонид Филлипов, Кирилл Ревнивцев

Пример как можно получить токен.

```bash
TOKEN=$(curl -d 'client_id=graveyard' -d 'username=k.revnivtsev@1440.space' -d 'password=password' -d 'grant_type=password' -d 'client_secret=clientSecret' 'https://sw-auth.1440.space/realms/sw-mcc/protocol/openid-connect/token' | jq -r '.access_token')
```
