from dataclasses import dataclass

from stw_py_api_runtime.gen_classes.gen_device import GenEvent
from stw_py_api_runtime.sdk.brokers.broker_api import BrokerAPI, EventCatcherAPI
from stw_py_api_runtime.sdk.brokers.message import DeviceAddress
{% if items %}
from stw_py_api_runtime.gen_classes.catchers.event_catcher import EventCatcher
from stw_py_api_runtime.gen_classes.telemetry.parse import EventMessage
from {{ self_import }}.basic_types import *
{% for type_import in imports  %}
{{ type_import }}
{% endfor %}
{% endif %}
{% for next_name in next_levels %}
from .{{ my_module_name }}.next_level import {{ next_name }}
{% endfor %}


{% for item in items  %}
@dataclass
class {{ item.type_name }}(EventMessage):
    """{{ item.docstring }}"""
    {% for param in item.params %}
    # {{ param.docstring }}
    {% if param.local_import %}
    {{ param.local_import }}
    {% endif %}
    {{ param.name }}: {{ param.param_type }}
    {% endfor %}


{% endfor %}
class Event(GenEvent):
    def __init__(self, device_address: DeviceAddress, broker: BrokerAPI, pygen_device):
        """Конструктор модуля событий."""
{% for next_name in next_levels %}
        self.{{ next_name }}: {{ next_name }}.Event = {{ next_name }}.Event(device_address, broker, pygen_device)
{% endfor %}

{% for item in items %}
        self.{{ item.tm_name }} = broker.event_catcher_class[{{ item.type_name }}](
            device_address=device_address, broker=broker, pygen_device=pygen_device, msg_type={{ item.type_name }}, name='{{ item.module_name }}.{{ denormalize_name(item.tm_name) }}', msg_id={{ item.msg_id }},
        )
{% endfor %}
